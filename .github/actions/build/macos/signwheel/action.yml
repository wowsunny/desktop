name: Sign Wheels
description: Unpack Sign Wheels and then RePack
runs:
  using: composite
  steps:
    - name: Unpack
      shell: sh
      run: |
        cd ./assets/python/wheels
        find . -name '*.whl' -exec sh -c 'unzip -d "${1%.*}" "$1"' _ {} \;
        find . -name "*.whl" -type f -delete
    - name: Gather and Sign
      shell: sh
      run: |
        cd ./assets/python/wheels
        find . -name "*so" -o -name "*.dylib" -print0 | while read -d $'\0' file; do codesign --sign 6698D856280DC1662A8E01E5B63428CB6D6651BB --force --timestamp --options runtime --entitlements ../../../scripts/entitlements.mac.plist "$file"; done
    - name: Repack
      shell: sh
      run: |
        for i in */; do zip -r "${i%/}.whl" "$i"; done
